name: Sync Dependents

on:
  workflow_run:
    workflows: ["Build and Release"]
    types:
      - completed
  workflow_dispatch:

jobs:
  trigger-updates:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    steps:
      - name: Trigger Dependent Workflows
        env:
          GH_TOKEN: ${{ secrets.PAT }}
        run: |
          if [ -z "$GH_TOKEN" ]; then
            echo "Error: PAT secret is not set."
            exit 1
          fi

          REPOS=(
            "vanes430/CoinsEngine-folia"
            "vanes430/ExcellentCrates-folia"
            "vanes430/ExcellentEnchants-folia"
            "vanes430/ExcellentShop-folia"
          )

          for REPO in "${REPOS[@]}"; do
            echo "Triggering workflow for $REPO..."
            gh workflow run build.yml --repo "$REPO" || echo "Failed to trigger $REPO"
          done